# 登录模块

1. 
#### 注册tab

![用户注册](./用户注册.png)

##### 注册tab-初始化

1. 调用静态Url`yanzhengma.jpg?_=`初始化或变更验证码图片

##### 注册tab-表单验证

1. 手机号验证
   焦点移出验证
   1. 编辑框为空, 则提示信息`请输入手机号`
   2. 手机号不符合手机号格式 `/^1[3|4|5|7|8|9][0-9]\d{8}$/`, 不符合则提示 `请输入正确的11位手机号码`
   3. 手机号验证 : 调用API接口 `singleAgencyHallOpen/isExistPhone`, 验证手机号手机号是否存在, 根据标准返回结果显示提示信息.
2. 密码1, 密码2
   1. 编辑框为空, 则提示信息`请输入6至20位密码`.
   2. 密码不在6至20, 则提示`密码长度需在6至20位`.
   3. 密码验证 : 判断密码1和密码2满足`同时存在且不相同`, 则提示`两次密码输入不一致`.
3. 图片验证码
   1. 编辑框为空, 则提示信息`请输入图片验证码`.
4. 短信验证码
   1. 编辑框为空, 则提示信息`请输入短信验证码`.
5. 用户名
   1. 编辑框为空, 则提示信息`请输入用户名`.
   2. 长度不在2至20位, 则提示`长度需在2至20位`.
6. 机构
   1. 编辑框为空, 则提示信息`请输入机构`.
   2. 机构若是填写形式则判断, 长度不在2至40位, 则提示`长度需在2至40位`.
7. 部门
   1. 编辑框为空, 则提示信息`请输入所属部门`.
   2. 长度不在2至40位, 则提示`长度需在2至40位`.
8. 职位
   1. 编辑框为空, 则提示信息`请输入所属部门`.
   2. 长度不在2至40位, 则提示`长度需在2至40位`.
9. 邮箱
   1. 编辑框为空, 则提示信息`请输入邮箱`.
   2. 不符合邮箱格式, 不符合则提示 `请输入正确的邮箱`

##### 注册tab-操作事件

1. 点击图片验证码调用调用静态Url`yanzhengma.jpg?_=`更改图片.
2. 点击机构调用机构查询API`singleAgencyHallOpen/getInstArrInfo`, 获取返回数据之后, 显示下拉列表, 选择机构后将文本填在编辑框.
3. 发送验证码按钮点击事件
   1. 调用后台API接口`singleAgencyHallOpen/sendRegisterSmsCode`发送短信.
   2. 按钮禁用, 置灰, 按钮显示60秒倒数文本. 倒数完成后按钮恢复正常.
4. 注册按钮点击事件
   1. 对注册表单进行再次验证.
   2. 判断机构编辑框内机构是否存在, 若不存在则弹出确认框`已有机构中并未发现和当前机构相符的机构名称, 是否继续`, 若选择否则直接返回.
   3. 调用注册API接口`singleAgencyHallOpen/registerAccount`执行注册事件, 具体逻辑请参照API文档.
   4. 注册失败, 需要调用图片验证码更改事件, 更换验证码图片.
   5. 注册成功, 跳转至登录页面.

#### 登录tab

![账户登录](./账户登录.png)

##### 登录tab-初始化

##### 登录tab-表单验证

1. 手机号验证
   焦点移出验证
   1. 编辑框为空, 则提示信息`请输入手机号`
   2. 手机号不符合手机号格式 `/^1[3|4|5|7|8|9][0-9]\d{8}$/`, 不符合则提示 `请输入正确的11位手机号码`.
   3. 调用后台API接口判断手机号是否需要验证码, 若需要验证码则显示图片验证码.
2. 密码
   1. 编辑框为空, 则提示信息`请输入密码`.
3. 图片验证码
   1. 编辑框为空, 则提示信息`请输入图片验证码`.

##### 登录tab-操作事件

1. 点击图片验证码调用调用静态Url`yanzhengma.jpg?_=`更改图片.
2. 登录按钮点击事件
   1. 对表单进行再次验证.
   2. 判断是否有图片验证码, 若没有则调用后台API接口`singleAgencyHallOpen/loginVerification`判断手机号是否需要验证码, 若需要验证码则显示验证码, 并返回.
   3. 调用登录API接口执行登录, 具体逻辑请参照API文档.
   4. 登录失败, 如果失败原因是需要图片验证码则显示图片验证码输入框.
   5. 登录成功, 跳转至I同业首页面.
3. 忘记密码点击事件
   1. 跳转至忘记重置密码页面.

#### 重置密码页面

![重置密码](./重置密码.png)

##### 重置密码-初始化

##### 重置密码-表单验证

1. 手机号验证
   焦点移出验证
   1. 编辑框为空, 则提示信息`请输入手机号`
   2. 手机号不符合手机号格式 `/^1[3|4|5|7|8|9][0-9]\d{8}$/`, 不符合则提示 `请输入正确的11位手机号码`
   3. 手机号验证 : 调用API接口 `singleAgencyHallOpen/isExistPhone`, 验证手机号手机号是否存在, 根据标准返回结果显示提示信息.
2. 密码1, 密码2
   1. 编辑框为空, 则提示信息`请输入6至20位密码`.
   2. 密码不在6至20, 则提示`密码长度需在6至20位`.
   3. 密码验证 : 判断密码1和密码2满足`同时存在且不相同`, 则提示`两次密码输入不一致`.
3. 图片验证码
   1. 编辑框为空, 则提示信息`请输入图片验证码`.
4. 短信验证码
   1. 编辑框为空, 则提示信息`请输入短信验证码`.

##### 重置密码-操作事件

1. 点击图片验证码调用调用静态Url`/yanzhengma.jpg`更改图片.
2. 发送验证码按钮点击事件
   1. 调用后台API接口`singleAgencyHallOpen/sendRegisterSmsCode`发送短信.
   2. 按钮禁用, 置灰, 按钮显示60秒倒数文本. 倒数完成后按钮恢复正常.
3. 重置密码点击事件
   1. 对表单进行再次验证.
   2. 重置API接口`singleAgencyHallOpen/resetPassword`执行登录, 具体逻辑请参照API文档.
   3. 注册失败, 需要调用图片验证码更改事件, 更换验证码图片.
   4. 注册成功, 跳转至登录页面.
